# Ruff configuration for backend linting and formatting
# See: https://docs.astral.sh/ruff/configuration/

# Exclude common directories
extend-exclude = [
    "venv",
    ".venv",
    "env",
    ".env",
    "__pycache__",
    ".pytest_cache",
    ".mypy_cache",
    ".ruff_cache",
    "htmlcov",
    "dist",
    "build",
    "*.egg-info",
    "testing-documents",
]

line-length = 120
target-version = "py311"

[lint]

fixable = ["ALL"]

# Allow unused variables when underscore-prefixed.
dummy-variable-rgx = "^(_+|(_+[a-zA-Z0-9_]*[a-zA-Z0-9]+?))$"

select = [
    "ALL"
]

# Rules to ignore
ignore = [
    "ANN", # flake8-annotations
    "COM", # flake8-commas
    "C90", # mccabe complexity
    "DJ",  # django
    "EXE", # flake8-executable
    "T10", # debugger
    "TID", # flake8-tidy-imports

    "B008",   # fastAPI convention
    "D100",   # ignore missing docs
    "D101",
    "D102",
    "D103",
    "D104",
    "D105",
    "D106",
    "D107",
    "D200",
    "D205",
    "D212",
    "D400",
    "D401",
    "D415",
    "EM101",
    "EM102",  # string literals
    "E402",   # false positives for local imports
    "E501",   # line too long
    "TRY003", # external messages in exceptions are too verbose
    "TD002",
    "TD003",
    "FIX002", # too verbose descriptions of todos
]

[lint.pydocstyle]
convention = "google"

[lint.per-file-ignores]
# Test files can use assertions and have more relaxed rules
"tests/**/*.py" = [
    "S105", "S106",    # Hardcoded passwords
    "SLF001",  # Accessing private methods
    "S101",    # Use of assert
    "BLE001",  # Broad exceptions
    "FBT",     # Booleans as positional arguments
    "ARG",     # Unused function arguments
    "PLR2004", # Magic values in tests are fine
    "F841",    # Unused local variables (common in test setup)
    "F401",    # Unused imports (fixtures, etc.)
]

# E2E tests can be long and complex
"tests/e2e/**/*.py" = [
    "PLR0915", # Too many statements (E2E tests are naturally long)
    "PLR0912", # Too many branches
]

# Integration tests with fixtures can have complex setup/teardown
"tests/integration/**/*.py" = [
    "PLR0912", # Too many branches (fixtures with cleanup)
    "PLR0915", # Too many statements
]

# Scripts can be long and complex
"scripts/*.py" = [
    "T201", # Print statements
    "PLR0912", # Too many branches
    "PLR0915", # Too many statements
]

"app/schemas/auth.py" = [
    "S105", # Hardcoded password for token
]

"app/routers/auth.py" = [
    "S106", # Hardcoded password for token
]
